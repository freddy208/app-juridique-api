generator client {
  provider = "prisma-client-js"
  //output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DIRECT_URL")
}

model Utilisateur {
  id                   String                @id @default(uuid())
  prenom               String
  nom                  String
  email                String                @unique
  motDePasse           String
  role                 RoleUtilisateur       @default(ASSISTANT)
  statut               StatutUtilisateur     @default(ACTIF)
  creeLe               DateTime              @default(now())
  modifieLe            DateTime              @updatedAt
  refreshToken         String?
  resetPasswordToken   String?
  resetPasswordExpires DateTime?
  archives             Archive[]
  correspondances      Correspondance[]
  documents            Document[]            @relation("DocumentsTeleverses")
  dossiers             Dossier[]             @relation("DossierResponsable")
  evenements           EvenementCalendrier[]
  journauxAudit        JournalAudit[]
  messages             MessageChat[]
  notes                Note[]
  tachesAssignees      Tache[]               @relation("AssigneTache")
  tachesCreees         Tache[]               @relation("CreateurTache")
}

model Client {
  id              String           @id @default(uuid())
  prenom          String
  nom             String
  nomEntreprise   String?
  telephone       String?
  email           String?
  adresse         String?
  statut          StatutClient     @default(ACTIF)
  creeLe          DateTime         @default(now())
  modifieLe       DateTime         @updatedAt
  correspondances Correspondance[]
  dossiers        Dossier[]
  factures        Facture[]
  notes           Note[]
}

model Dossier {
  id               String                @id @default(uuid())
  numeroUnique     String                @unique
  clientId         String
  titre            String
  type             TypeDossier
  description      String?
  responsableId    String?
  statut           StatutDossier         @default(OUVERT)
  creeLe           DateTime              @default(now())
  modifieLe        DateTime              @updatedAt
  contentieux      Contentieux?
  contrat          Contrat?
  documents        Document[]
  client           Client                @relation(fields: [clientId], references: [id])
  responsable      Utilisateur?          @relation("DossierResponsable", fields: [responsableId], references: [id])
  evenements       EvenementCalendrier[]
  factures         Facture[]
  immobilier       Immobilier?
  messages         MessageChat[]
  notes            Note[]
  sinistreCorporel SinistreCorporel?
  sinistreMateriel SinistreMateriel?
  sinistreMortel   SinistreMortel?
  sport            Sport?
  taches           Tache[]
}

model SinistreCorporel {
  id              String          @id @default(uuid())
  dossierId       String          @unique
  dateAccident    DateTime
  lieuAccident    String
  numeroPvPolice  String?
  hopital         String?
  rapportMedical  String?
  graviteBlessure GraviteBlessure @default(MINEUR)
  assureur        String?
  numeroSinistre  String?
  temoins         Json?
  prejudice       Decimal?
  creeLe          DateTime        @default(now())
  modifieLe       DateTime        @updatedAt
  dossier         Dossier         @relation(fields: [dossierId], references: [id])
}

model SinistreMateriel {
  id                String             @id @default(uuid())
  dossierId         String             @unique
  dateAccident      DateTime
  lieuAccident      String
  categorieVehicule CategorieVehicule?
  marqueVehicule    String?
  modeleVehicule    String?
  immatriculation   String?
  numeroChassis     String?
  numeroPvPolice    String?
  assureur          String?
  numeroSinistre    String?
  estimationDegats  Decimal?
  photosUrls        Json?
  creeLe            DateTime           @default(now())
  modifieLe         DateTime           @updatedAt
  dossier           Dossier            @relation(fields: [dossierId], references: [id])
}

model SinistreMortel {
  id                    String   @id @default(uuid())
  dossierId             String   @unique
  dateDeces             DateTime
  lieuDeces             String?
  certificatDeces       String?
  certificatMedicoLegal String?
  numeroPvPolice        String?
  causeDeces            String?
  ayantsDroit           Json?
  indemniteReclamee     Decimal?
  creeLe                DateTime @default(now())
  modifieLe             DateTime @updatedAt
  dossier               Dossier  @relation(fields: [dossierId], references: [id])
}

model Immobilier {
  id               String         @id @default(uuid())
  dossierId        String         @unique
  adresseBien      String
  numeroTitre      String?
  numeroCadastre   String?
  referenceNotaire String?
  regimeFoncier    RegimeFoncier?
  surfaceM2        Decimal?
  typeLitige       String?
  chefQuartier     String?
  temoinsBornage   Json?
  creeLe           DateTime       @default(now())
  modifieLe        DateTime       @updatedAt
  dossier          Dossier        @relation(fields: [dossierId], references: [id])
}

model Sport {
  id               String    @id @default(uuid())
  dossierId        String    @unique
  club             String?
  competition      String?
  dateIncident     DateTime?
  instanceSportive String?
  referenceContrat String?
  sanctions        Json?
  creeLe           DateTime  @default(now())
  modifieLe        DateTime  @updatedAt
  dossier          Dossier   @relation(fields: [dossierId], references: [id])
}

model Contrat {
  id               String    @id @default(uuid())
  dossierId        String    @unique
  partieA          String
  partieB          String
  dateEffet        DateTime
  dateExpiration   DateTime?
  valeurContrat    Decimal?
  loiApplicable    String?   @default("CAMEROUN")
  referenceNotaire String?
  contratUrl       String?
  creeLe           DateTime  @default(now())
  modifieLe        DateTime  @updatedAt
  dossier          Dossier   @relation(fields: [dossierId], references: [id])
}

model Contentieux {
  id              String          @id @default(uuid())
  dossierId       String          @unique
  numeroAffaire   String?
  tribunal        String?
  juridiction     String?
  demandeur       String?
  defendeur       String?
  avocatPlaignant String?
  avocatDefenseur String?
  etapeProcedure  EtapeProcedure? @default(INSTRUCTIVE)
  montantReclame  Decimal?
  datesAudiences  Json?
  depots          Json?
  rapportHussier  String?
  creeLe          DateTime        @default(now())
  modifieLe       DateTime        @updatedAt
  dossier         Dossier         @relation(fields: [dossierId], references: [id])
}

model Document {
  id           String         @id @default(uuid())
  dossierId    String
  televersePar String
  titre        String
  type         String
  url          String
  version      Int            @default(1)
  statut       StatutDocument @default(ACTIF)
  creeLe       DateTime       @default(now())
  modifieLe    DateTime       @updatedAt
  dossier      Dossier        @relation(fields: [dossierId], references: [id])
  utilisateur  Utilisateur    @relation("DocumentsTeleverses", fields: [televersePar], references: [id])
}

model Tache {
  id          String       @id @default(uuid())
  dossierId   String?
  titre       String
  description String?
  assigneeId  String?
  creeParId   String
  dateLimite  DateTime?
  statut      StatutTache  @default(A_FAIRE)
  creeLe      DateTime     @default(now())
  modifieLe   DateTime     @updatedAt
  assignee    Utilisateur? @relation("AssigneTache", fields: [assigneeId], references: [id])
  createur    Utilisateur  @relation("CreateurTache", fields: [creeParId], references: [id])
  dossier     Dossier?     @relation(fields: [dossierId], references: [id])
}

model EvenementCalendrier {
  id          String          @id @default(uuid())
  dossierId   String?
  titre       String
  description String?
  debut       DateTime
  fin         DateTime
  creeParId   String
  statut      StatutEvenement @default(PREVU)
  creeLe      DateTime        @default(now())
  modifieLe   DateTime        @updatedAt
  createur    Utilisateur     @relation(fields: [creeParId], references: [id])
  dossier     Dossier?        @relation(fields: [dossierId], references: [id])
}

model MessageChat {
  id           String        @id @default(uuid())
  dossierId    String?
  expediteurId String
  contenu      String
  statut       StatutMessage @default(ENVOYE)
  creeLe       DateTime      @default(now())
  modifieLe    DateTime      @updatedAt
  dossier      Dossier?      @relation(fields: [dossierId], references: [id])
  expediteur   Utilisateur   @relation(fields: [expediteurId], references: [id])
}

model Facture {
  id           String        @id @default(uuid())
  dossierId    String?
  clientId     String
  montant      Decimal
  dateEcheance DateTime
  payee        Boolean       @default(false)
  statut       StatutFacture @default(BROUILLON)
  creeLe       DateTime      @default(now())
  modifieLe    DateTime      @updatedAt
  client       Client        @relation(fields: [clientId], references: [id])
  dossier      Dossier?      @relation(fields: [dossierId], references: [id])
}

model PermissionRole {
  id          String           @id @default(uuid())
  role        RoleUtilisateur
  module      String
  lecture     Boolean          @default(true)
  ecriture    Boolean          @default(false)
  suppression Boolean          @default(false)
  statut      StatutPermission @default(ACTIF)
  creeLe      DateTime         @default(now())
  modifieLe   DateTime         @updatedAt
}

model JournalAudit {
  id             String      @id @default(uuid())
  utilisateurId  String
  action         String
  typeCible      String
  cibleId        String
  ancienneValeur Json?
  nouvelleValeur Json?
  creeLe         DateTime    @default(now())
  utilisateur    Utilisateur @relation(fields: [utilisateurId], references: [id])
}

model Archive {
  id          String        @id @default(uuid())
  typeObjet   String
  objetId     String
  archivePar  String
  dateArchive DateTime      @default(now())
  statut      StatutArchive @default(ARCHIVE)
  creeLe      DateTime      @default(now())
  modifieLe   DateTime      @updatedAt
  utilisateur Utilisateur   @relation(fields: [archivePar], references: [id])
}

model Correspondance {
  id            String             @id @default(uuid())
  clientId      String
  utilisateurId String
  type          TypeCorrespondance
  contenu       String?
  creeLe        DateTime           @default(now())
  modifieLe     DateTime           @updatedAt
  client        Client             @relation(fields: [clientId], references: [id])
  utilisateur   Utilisateur        @relation(fields: [utilisateurId], references: [id])
}

model Note {
  id            String      @id @default(uuid())
  clientId      String?
  dossierId     String?
  utilisateurId String
  contenu       String
  statut        StatutNote  @default(ACTIF) // <- ajouter
  creeLe        DateTime    @default(now())
  modifieLe     DateTime    @updatedAt
  client        Client?     @relation(fields: [clientId], references: [id])
  dossier       Dossier?    @relation(fields: [dossierId], references: [id])
  utilisateur   Utilisateur @relation(fields: [utilisateurId], references: [id])
}

enum RoleUtilisateur {
  ADMIN
  DG
  AVOCAT
  SECRETAIRE
  ASSISTANT
  JURISTE
  STAGIAIRE
}

enum StatutUtilisateur {
  ACTIF
  INACTIF
  SUSPENDU
}

enum StatutClient {
  ACTIF
  INACTIF
}

enum TypeDossier {
  SINISTRE_CORPOREL
  SINISTRE_MATERIEL
  SINISTRE_MORTEL
  IMMOBILIER
  SPORT
  CONTRAT
  CONTENTIEUX
  AUTRE
}

enum StatutDossier {
  OUVERT
  EN_COURS
  CLOS
  ARCHIVE
}

enum GraviteBlessure {
  MINEUR
  MOYEN
  GRAVE
  CRITIQUE
}

enum CategorieVehicule {
  VOITURE
  MOTO
  CAMION
  AUTRE
}

enum RegimeFoncier {
  TITRE_FONCIER
  COUTUMIER
  BAIL
}

enum EtapeProcedure {
  INSTRUCTIVE
  AUDIENCE
  JUGEMENT
  APPEL
  EXECUTION
}

enum StatutDocument {
  ACTIF
  ARCHIVE
  SUPPRIME
}

enum StatutTache {
  A_FAIRE
  EN_COURS
  TERMINEE
}

enum StatutEvenement {
  PREVU
  TERMINE
  ANNULE
}

enum StatutMessage {
  ENVOYE
  LU
  SUPPRIME
}

enum StatutFacture {
  BROUILLON
  ENVOYEE
  PAYEE
  EN_RETARD
}

enum StatutPermission {
  ACTIF
  INACTIF
}

enum StatutArchive {
  ARCHIVE
  RESTAURE
}

enum TypeCorrespondance {
  APPEL
  EMAIL
  RENDEZ_VOUS
  AUTRE
}
enum StatutNote {
  ACTIF
  SUPPRIME
}